<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Articulations</title>
</head>
<body>
  <h1>Select a University</h1>
  <select id="uni-select">
    <option value="">--Select a University--</option>
  </select>

  <h2>Courses</h2>
  <select id="course-select">
    <option value="">--Select University First--</option>
  </select>

  <h2>Articulations</h2>
  <div id="articulations-container">
    <!-- Articulation JSONs will render here -->
  </div>

  <script>
    // 1) Populate universities
    fetch('./data/institutions_state.json')
      .then(res => res.json())
      .then(inst => {
        const uniSelect = document.getElementById('uni-select');
        Object.entries(inst).forEach(([id, name]) => {
          const opt = document.createElement('option');
          opt.value = id;
          opt.textContent = name;
          uniSelect.appendChild(opt);
        });
      });

    // 2) On university change → load courses
    document.getElementById('uni-select').addEventListener('change', e => {
      const uniId = e.target.value;
      const courseSelect = document.getElementById('course-select');
      courseSelect.innerHTML = '<option value="">--Select a Course--</option>';
      document.getElementById('articulations-container').innerHTML = '';
      if (!uniId) return;
      fetch(`https://3v2snkzdyb36asakkx3js3fk5y0dadkd.lambda-url.us-east-2.on.aws/?uni=${encodeURIComponent(uniId)}`)
        .then(res => res.json())
        .then(courses => {
          courses.forEach(course => {
            const opt = document.createElement('option');
            opt.value = course.course_id;
            opt.textContent = `${course.course_code} - ${course.course_name}`;
            courseSelect.appendChild(opt);
          });
        })
        .catch(console.error);
    });

    // 3) On course change → load articulations
    document.getElementById('course-select').addEventListener('change', e => {
      const courseId = e.target.value;
      const container = document.getElementById('articulations-container');
      container.innerHTML = '';
      if (!courseId) return;
      fetch(`https://htj3ct4guetoyy26rxhsqjgo4u0lurpp.lambda-url.us-east-2.on.aws/?course_id=${encodeURIComponent(courseId)}`)
        .then(res => res.json())
        .then(arts => {
          arts.forEach(item => {
            const pre = document.createElement('pre');
            pre.textContent = JSON.stringify(JSON.parse(item.articulation), null, 2);
            container.appendChild(pre);
          });
        })
        .catch(console.error);
    });
  </script>
</body>
</html>
