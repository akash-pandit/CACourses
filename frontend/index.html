<!DOCTYPE html>
<html data-theme="light">
<head>
    <!-- Metadata -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- external resources -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script src="utils.js"></script>
    <script src="alpine-component.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.9/dist/cdn.min.js"></script>

    <!-- site edit -->
    <title>Course Articulations</title>
    <style>
        [x-cloak] { display: none !important }
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<!------------------------------------------------------------------>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
    <h1 class="mt-10 text-6xl font-extrabold text-gray-800 text-center mb-3">CA Courses</h1>
    <h3 class="text-gray-600 text-center mb-3">
        <a href="javascript:void(0)" onclick="alert('Coming soon, stay tuned!')" class="mx-4">About CACourses</a> 
        <a href="https://github.com/akash-pandit/CACourses" target="_blank" class="mx-4">Source Code</a>
        <a href="https://linkedin.com/in/akash-pandit-" class="mx-4">LinkedIn</a>
    </h3>

    <!-- Main alpine reactive block -->
    <div x-data="alpineMain">

        <!-- query block -->
        <div class="bg-white rounded-xl shadow-xl p-8 max-w-6xl mx-auto space-y-8 mb-10">
            <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 text-center text-lg text-gray-700 font-semibold">
                <span class="inline-block md:inline">At</span>
                
                <!-- University Picker -->
                <div class="relative w-full md:w-auto">
                    <input 
                        type="text" 
                        class="w-full md:w-full px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-gray-600 transition-all duration-200 placeholder:text-center"
                        @focus="showUniOpts = true"
                        @blur="handleBlur('univ')"
                        @keydown="handleKeydown($event, 'uni')"
                        :placeholder="univ != null ? shortenUniName(univ) : 'University'"
                        x-model="univSearching"
                    >
                    <!-- Uni picker dropdown -->
                    <div x-show="showUniOpts"
                        class="absolute z-10 w-full md:w-auto mt-2 bg-white rounded-xl shadow-lg border border-gray-200 overflow-y-auto max-h-64 transition-all duration-200"
                        x-cloak
                    >
                        <div x-show="loadingUnis" class="p-4 text-center text-gray-400">Loading universities...</div>
                        <ul x-show="!loadingUnis && searchUnis.length > 0" class="py-2">
                            <template x-for="([name, id], index) in searchUnis" :key="id">
                                <li
                                    @click="selectUni(name, id)"
                                    @mouseenter="activeIndex = index"
                                    :class="{ 'bg-gray-200': activeIndex === index, 'hover:bg-gray-100': activeIndex !== index }"
                                    class="cursor-pointer px-4 py-3 text-sm text-gray-800 transition-colors duration-200"
                                    x-text="name"
                                ></li>
                            </template>
                        </ul>
                        <div x-show="!loadingUnis && searchUnis.length === 0" class="p-4 text-center text-gray-400">
                            No universities found.
                        </div>
                    </div>
                </div>

                <span class="inline-block md:inline"> I can replace </span>
                
                <!-- Course Picker -->
                <div class="relative w-full md:w-auto">
                    <input
                        type="text"
                        class="w-full md:w-40 px-4 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 placeholder:text-center"
                        @focus="showCourseOpts = true"
                        @keydown="handleKeydown($event, 'course')"
                        @blur="handleBlur('course')"
                        :placeholder="course !== null ? course : 'Course'"
                        :disabled="univID === null"
                        :class="univID === null ? 'placeholder:text-gray-400' : 'placeholder:text-gray-600'"
                        x-model="courseSearching"
                    >
                    <!-- Class picker dropdown -->
                    <div x-show="showCourseOpts"
                        class="absolute left-1/2 -translate-x-1/2 z-10 w-full md:w-96 mt-2 bg-white rounded-xl shadow-lg border border-gray-200 overflow-y-scroll max-h-64 transition-all duration-200 justify-center"
                        x-cloak
                    >
                        <div x-show="loadingCourses" class="p-4 text-center text-gray-400">Loading courses...</div>
                        <ul x-show="!loadingCourses && searchCourses.length > 0" class="py-2">
                            <template x-for="(c, index) in searchCourses" :key="c.course_code">
                                <li
                                    @click="selectCourse(c.course_code, c.course_id)"
                                    @mouseenter="activeIndex = index"
                                    :class="{ 'bg-gray-200': activeIndex === index, 'hover:bg-gray-100': activeIndex !== index }"
                                    class="cursor-pointer px-4 py-3 text-sm text-gray-800 transition-colors duration-200"
                                    x-text="c.course_code + ': ' + c.course_name"
                                ></li>
                            </template>
                        </ul>
                        <div x-show="!loadingCourses && searchCourses.length === 0" class="p-4 text-center text-gray-400">
                            No courses found.
                        </div>
                    </div>
                </div>
                <span class="inline-block md:inline">with...</span>
            </div>
        </div>
        
        <!-- <div x-text="`showArticulationBlock: ${showArticulationBlock}`" class="text-center text-sm text-gray-500 mt-4 space-y-2"></div>  -->
        <!-- articulation block -->
        <div x-show="showArticulationBlock" class="bg-white rounded-2xl shadow-xl px-8 pt-1 pb-9 max-w-6xl mx-auto space-y-8 mb-10">
            <template x-if="Object.entries(articulations).length > 0">
                <template x-for="[cc, matrix] in Object.entries(articulations)" :key="cc">
                    <!-- Community College Block -->
                    <div class="bg-white shadow-lg border border-gray-200 rounded-2xl overflow-hidden">
                        <!-- CC Block: CC Name-->
                        <div class="bg-gray-800 px-4 py-2">
                            <h2 x-text="getCCName(cc)" class="text-white text-sm tracking-wider"></h2>
                        </div>
                        <!-- CC Block: Body-->
                        <div class="p-4 space-y-4">
                            <template x-for="(andBlock, index) in matrix" :key="index">
                                <!-- Wrap in single element for alpine's for directive -->
                                <div>
                                    <!-- OR divider -->
                                    <template x-if="index > 0">
                                        <div class="flex items-center my-4">
                                            <div class="flex-grow border-t border-gray-200"></div>
                                            <span class="mx-4 text-xs font-bold text-gray-400 uppercase">OR</span>
                                            <div class="flex-grow border-t border-gray-200"></div>
                                        </div>
                                    </template>
                                    
                                    <!-- OR block -->
                                    <div class="items-center p-3 bg-gray-100 border border-gray-150 rounded-md">
                                        <template x-for="(course, cIndex) in andBlock" :key="cIndex">
                                            <!-- Wrap in single element for alpine's for directive -->
                                            <div>
                                                <!-- AND divider -->
                                                <template x-if="cIndex > 0">
                                                    <div class="flex items-center">
                                                        <div class="flex-grow border-t border-gray-200"></div>
                                                        <span class="mx-4 text-xs font-bold text-gray-400 uppercase">AND</span>
                                                        <div class="flex-grow border-t border-gray-200"></div>
                                                    </div>
                                                </template>

                                                <!-- AND block -->
                                                <div class="grid grid-cols-1 gap-2">
                                                    <div class="flex items-center p-3 rounded-md">
                                                        <div class="flex-shrink-0 w-24">
                                                            <span class="text-gray-700 font-bold text-sm" x-text="course.code"></span>
                                                        </div>
                                                        <div class="ml-4 border-l border-gray-250 pl-4">
                                                            <span class="text-gray-700 text-sm" x-text="course.name"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </template>
            <template x-if="Object.entries(articulations).length === 0">
                <p class="text-center text-lg text-gray-600 font-semibold">No Substitutes Available For This Course</p>
            </template>
        </div>
        
        <!-- Debug -->
        <!-- <div class="text-center text-sm text-gray-500 mt-4 space-y-2">
            <div x-text="`univSearching: ${univSearching} univ: ${univ} univID: ${univID} showUniOpts: ${showUniOpts}`"></div>
            <div x-text="`courseSearching: ${courseSearching} course: ${course} courseID: ${courseID}`"></div>
            <div x-text="`articulations: ${articulations}`"></div>
        </div> -->
        <footer class="text-center text-sm text-gray-500 mt-4 space-y-2">
            <div>Created and Maintained by Akash Pandit</div>
            <div>Powered by AWS Lambda, Vercel, Supabase, and the Polars library</div>
            <div class="">
                Not affiliated with ASSIST.org, the University of California, the California State University, or California Community Colleges.
            </div>
        </footer>

</body>
</html>